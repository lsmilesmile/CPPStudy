# 文件操作

> Felix
>
> 2022.6.16



## C文件操作

1. 文件指针

   每一个被使用的文件都在内存中开辟了一个相应的文件信息区，用来存放文件的相关信息(文件名字，文件状态及文件当前的位置等)。这些信息保存在一个结构体变量中。该结构体由系统声明，取名为FILE.

   stdio.h头文件中有以下文件类型声明：

   ```c++
   struct _iobuf {
       char *_ptr;
       int  _cnt;
       char *_base;
       int  _flag;
       int  _file;
       int  _charbuf;
       int  _bufsiz;
       char *_tmpfname;
      };
   typedef struct _iobuf FILE;
   ```

   创建一个FILE类型的指针

   ```c++
   FILE* pf; // 文件指针变量
   ```

   定义的pf是一个指向FILE类型数据的指针变量。可以使得pf指向某个文件的文件信息区（结构体变量）。通过该文件信息区中的信息就能够访问该文件。即：通过文件指针变量能够找到与它关联的文件。

2. 文件打开关闭

   ```c++
   // 打开文件
   FILE* fopen(const char* filename, const char* mode);
   // 关闭文件
   int fclose(FILE* stream);
   ```

   文件访问模式：

   ![](./imgs/1.jpg)

   code:

   ```c++
   /// C文件读写
   
   
   #include <cstdio>
   #include <cerrno>
   #include <cstring>
   
   int main() {
       FILE* pf = fopen("data.txt", "w");
       if (pf == NULL) {
           printf("%s\n", strerror(errno));
           return -1;
       }
       fclose(pf);
       pf = NULL;
       return 0;
   }
   ```

   

3. 文件顺序读写

   ![](./imgs/2.jpg)

   函数解释：

   ```c++
   fgetc - 从流中读取一个字符
   int fgetc(FILE* stream);
   stream - 指向FILE结构的指针
   
   fputc - 将字符写入流
   int fputc(int c, FILE* stream);
   c - 要写入的字符    stream - 指向FILE结构的指针
   ```

   code:

   ```c++
   #include <cstdio>
   #include <cerrno>
   #include <cstring>
   
   int main() {
       FILE* pf = fopen("data.txt", "w");
       if (pf == NULL) {
           printf("%s\n", strerror(errno));
           return -1;
       }
       char ch;
       for (ch = 'a'; ch <= 'z'; ch++) {
           fputc(ch, pf);
           fputc(ch, stdout);
       }
       fclose(pf);
       pf = NULL;
       return 0;
   }
   ```

   ```c++
   #include <cstdio>
   #include <cerrno>
   #include <cstring>
   
   int main() {
       FILE* pf = fopen("data.txt", "r");
       if (pf == NULL) {
           printf("%s\n", strerror(errno));
           return -1;
       }
       int ch;
       while ((ch = fgetc(pf)) != EOF)
       {
           /* code */
           printf("%c", ch);
       }
       
       fclose(pf);
       pf = NULL;
       return 0;
   }
   ```

   ```c++
   fgets - 从流中获取一个字符串
   char *fgets(char* string, int n, FILE* stream);
   string - 数据的存储位置    n - 要读取的最大字符数    stream - 指向FILE结构的指针
   
   fputs - 将字符串写入流
   int fputs(const char* string, FILE* stream);
   string - 输出字符串    stream - 指向FILE结构的指针
   ```

   code:

   ```c++
   #include <cstdio>
   #include <cerrno>
   #include <cstring>
   
   int main() {
       FILE* pf = fopen("data.txt", "w");
       if (pf == NULL) {
           printf("%s\n", strerror(errno));
           return -1;
       }
       fputs("hello world\n", pf);
       fputs("hehe\n", pf);
       fclose(pf);
       pf = NULL;
       return 0;
   }
   ```

   ```c++
   #include <cstdio>
   #include <cerrno>
   #include <cstring>
   
   int main() {
       FILE* pf = fopen("data.txt", "r");
       if (pf == NULL) {
           printf("%s\n", strerror(errno));
           return -1;
       }
       char buf[100];
       fgets(buf, 4, pf);
       printf(buf);
       fclose(pf);
       pf = NULL;
       return 0;
   }
   ```

   ```c++
   fscanf - 从流中读取格式化的数据
   int fscanf( FILE *stream, const char *format [, argument ]... );
   stream - 指向FILE结构的指针  format - 格式控制字符串  argument - 可选参数
   
   fprintf - 将格式化的数据打印到流中
   int fprintf( FILE *stream, const char *format [, argument ]...);
   stream - 指向FILE结构的指针  format - 格式控制字符串  argument - 可选参数 
   
   fread - 从文件中读二进制数据
   size_t fread( void *buffer, size_t size, size_t count, FILE *stream );
   buffer - 数据的储存位置  size - 项目大小(以字节为单位)  count - 要读取的最大项数  stream - 指向FILE结构的指针
   
   fwrite - 以二进制形式向流中写入数据
   size_t fwrite( const void *buffer, size_t size, size_t count, FILE *stream );
   buffer - 数据的储存位置  size - 项目大小(以字节为单位)  count - 要读取的最大项数  stream - 指向FILE结构的指针
   ```

   code:

   ```c++
   #include <cstdio>
   #include <cerrno>
   #include <cstring>
   
   struct Stu {
       char name[20];
       int age;
       double d;
   };
   
   int main() {
       Stu s[2] = {
           {"name1", 17, 1.2},
           {"name2", 14, 3.2}
       };
   
       // 二进制方式写文件
       // FILE* pf = fopen("data.txt", "wb");
       // if (pf == NULL) {
       //     printf("%s\n", strerror(errno));
       //     return -1;
       // }
       // fwrite(s, sizeof(Stu), 2, pf);
       // fclose(pf);
       // pf = NULL;
   
       // 二进制方式读文件
       FILE* pf = fopen("data.txt", "rb");
        if (pf == NULL) {
           printf("%s\n", strerror(errno));
           return -1;
       }
       fread(s, sizeof(Stu), 2, pf);
       printf("%s %d %1f\n", s[0].name, s[0].age, s[0].d);
       printf("%s %d %1f\n", s[1].name, s[1].age, s[1].d);
   
   
       return 0;
   }
   ```

   

4. ddd